import{_ as ke,u as ve,b as he,i as H,e as n,k as J,l as ge,E as fe,f as we,r as I,o as c,g as _,j as t,h as p,w as r,q as ye,G as be,F as U,x as X,a as j,t as m,m as T,c as O,p as xe,H as Ie,n as te,z as je,A as Te}from"./index-1cf03590.js";import{C as Ce}from"./CourseStore-621525c2.js";const C=V=>(je("data-v-50e6a362"),V=V(),Te(),V),Se={class:"wrap"},Ne={class:"classTableWrap"},$e={class:"right"},De={key:0,class:"selectDate"},We=["value"],Be={key:0,class:"current_Week"},ze={class:"current_Week_num"},qe={key:1,bordered:!1,"single-line":!1},Pe={class:"classTable"},Me={style:{"font-size":"12px",height:"5px",display:"inline-block"}},Ue={style:{"font-size":"12px",height:"5px",display:"inline-block"}},Ve={style:{width:"100%"}},Fe=["onClick"],Le={class:"courseName"},Ae={class:"courseClassroomName"},Ge=C(()=>t("div",{class:"classDetailHeader"},[t("p",null,"哦吼！原来今天还要上课嘞？"),t("p",null,"？？？")],-1)),He={class:"classDetailContent"},Xe={class:"content"},Ee=C(()=>t("span",{class:"content_left"},"课程名称:",-1)),Ke={class:"content_right"},Re=C(()=>t("span",{class:"content_left"},"时间:",-1)),Ye={class:"content_right"},Je=C(()=>t("span",{class:"content_left"},"地点:",-1)),Oe={class:"content_right"},Qe=C(()=>t("span",{class:"content_left"},"教师:",-1)),Ze={class:"content_right"},et=C(()=>t("span",{class:"content_left"},"教学周:",-1)),tt={class:"content_right"},st=C(()=>t("div",{class:"classDetailFooter"},[t("p",null,"快去学习！"),t("p",null,"要不给你打个鸡血？"),t("p",null,"额。。。"),t("p",null,"还是算了~")],-1)),ot={__name:"Courses",setup(V){ve();const se=he(),F=H("axios"),D=H("message"),oe=H("dialog"),S=H("loadingBar"),y=Ce(),g=n(1),b=n([]),f=n([]),L=n(!1),k=J({courseNameTitle:"",courseTime:"",coursePosition:"",courseTeacher:"",courseNeedWeek:""}),ae=ge(()=>new Date().getDay()),A=n(!1);n("today");const le=n({width:"80%",height:"60vh"}),E=n(""),v=n(!1),K=[],a=J({account:"",password:""}),W=n(null);fe(W,e=>{console.log("watch date_week"),console.log(`date_week.value:${e}`),e!=null&&(g.value=e,console.log(`week.value:${g.value}`),z())});const d=J({maxWeek:"21",semesterId:"2023-2024-1",today:"2023-09-27",week:"5",weekday:"星期三"}),Q=n([]),ne=()=>{oe.create({type:"warning",title:"退出登录?",content:"退出了可就要重新登录了哈，而且慧通九职哪里也要重新登录",negativeText:"点错了",positiveText:"退出",onNegativeClick:()=>{},onPositiveClick:()=>{localStorage.removeItem("school_course_user_token"),localStorage.removeItem("school_user_token"),localStorage.removeItem("kbjcmsid"),v.value=!1}})},ce=()=>{if(console.log("jumpToday"),W.value=null,console.log(`week.value :${g.value} parseInt(topInfo.week):${parseInt(d.week)}`),g.value==parseInt(d.week)){D.warning("就是今天哦",{duration:600});return}g.value=parseInt(d.week),localStorage.setItem("week",d.week),z()};we(()=>{B.value=y.usertoken==""?localStorage.getItem("school_course_user_token"):y.usertoken,R.value=y.x_id_token==""?localStorage.getItem("school_course_user_token"):y.x_id_token,N.value=y.token==""?localStorage.getItem("school_user_token"):y.token,$.value=y.kbjcmsid==""?localStorage.getItem("kbjcmsid"):y.kbjcmsid,g.value=localStorage.getItem("week"),B.value&&N.value?(v.value=!0,z()):v.value=!1,K.push({label:"选择周次",value:null});for(let e=1;e<=d.maxWeek;++e)K.push({label:`星期${e}`,value:e})});const re=()=>{if(A.value&&(a.account="223050659",a.password="XXYXxxyx666"),a.account==""){D.warning("就不能输个账号？",{duration:1e3});return}if(a.password==""){D.warning("就不能输个密码？",{duration:1e3});return}console.log(a.account),console.log(a.password),de(),a.account="",a.password=""},ue=e=>{e.courseName!=E.value&&(console.log(e),L.value=!0,k.courseNameTitle=`${e.courseName} (${e.fzmc==""?"不是体育课，废话！-_- ":e.fzmc}) `,k.courseTime=` ${ie(e.classTime)} (${e.startTime}-${e.endTIme})`,k.coursePosition=e.classroomName,k.courseTeacher=e.teacherName,k.courseNeedWeek=`第${e.classWeek}周`)},ie=e=>{let o=e.substring(0,1),u=e.substring(1,e.length);switch(o){case"1":o="星期一";break;case"2":o="星期二";break;case"3":o="星期三";break;case"4":o="星期四";break;case"5":o="星期五";break;case"6":o="星期六";break;case"7":o="星期日";break}return u=`第${u}节`,`${o}，${u}`},B=n(""),R=n(""),N=n(""),$=n(""),de=async()=>{S.start();try{let e=await F({url:"/course/get_login",method:"post",params:{username:a.account,password:a.password}});B.value=e.data.data.idToken,R.value=e.data.data.idToken,console.log(e),localStorage.setItem("school_course_user_token",B.value),v.value=!0,z(),S.finish()}catch{D.error("登录失败"),S.error()}},_e=async()=>{console.log("getToken"),await F({url:"/course/get_token",method:"get",params:{url:"http://m-jiaowu.jvtc.jx.cn/njwhd/loginSso?toMenu=xs_kcb"},headers:{usertoken:B.value,x_id_token:R.value}}).then(e=>{const o=e.data,u=/token=([^&]+)/;let w=o.match(u)[1];N.value=w,localStorage.setItem("school_user_token",N.value),$.value||pe()})},pe=async()=>{console.log("getSjikbms");let o=(await F({url:"/course/get_sjkbms",method:"post",params:{url:"http://mm-jiaowu.jvtc.jx.cn/njwhd/Get_sjkbms",token:N.value}})).data.data[0].kbjcmsid;console.log(`_kbjcmsid:${o}`),$.value=o,localStorage.setItem("kbjcmsid",$.value),z()},z=async()=>{console.log("GetKCB"),S.start(),f.value=[],b.value=[],console.log(`week.value:${g.value} kbjcmsid.value:${$.value}`);let e=await F({url:"/course/get_kcb",method:"post",params:{url:`http://mm-jiaowu.jvtc.jx.cn/njwhd/student/curriculum?week=${g.value}&kbjcmsid=${$.value}`,token:N.value}});if(console.log(e.data.code),e.data.code!="1"){S.error(),_e();return}if(Q.value=e.data.data[0].date,d.maxWeek=e.data.data[0].topInfo[0].maxWeek,d.semesterId=e.data.data[0].topInfo[0].semesterId,d.today=e.data.data[0].topInfo[0].today,d.week=e.data.data[0].topInfo[0].week,d.weekday=e.data.data[0].topInfo[0].weekday,parseInt(d.week)==parseInt(W.value)&&localStorage.setItem("week",d.week),e.data.code=="1"){let o=[],u=[],q=[],w=[],G=[],P=[];for(let i=0;i<e.data.data[0].item.length;i++){const h=e.data.data[0].item[i];for(let s=0;s<h.length;s++){const l=h[s][0];switch(parseInt(l.classTime.substring(2,3))){case 1:o.push(l);break;case 3:u.push(l);break;case 5:q.push(l);break;case 7:w.push(l);break;case 9:G.push(l);break;case 11:P.push(l);break}}}f.value.push(o),f.value.push(u),f.value.push(q),f.value.push(w),f.value.push(G),f.value.push(P);for(let i=0;i<6;i++){const h=[];for(let s=0;s<7;s++)h.push({courseName:E.value,classTime:2*i+1,weekDay:s+1});b.value.push(h)}for(let i=0;i<f.value.length;i++){const h=f.value[i];for(let s=0;s<h.length;s++){const l=h[s],x=parseInt(l.classTime.substring(2,3)),Y=parseInt(l.weekDay);for(let M=0;M<b.value.length;M++){const Z=b.value[M].findIndex(ee=>ee.weekDay===Y&&ee.classTime===x);if(Z!==-1){b.value[M][Z]=l;break}}}}console.log(b.value),S.finish()}else D.error(`加载课程表时出现错误！${e.data.Msg}`),console.log(e.data.Msg)},me=()=>{se.push("/")};return(e,o)=>{const u=I("n-button"),q=I("n-button-group"),w=I("n-space"),G=I("n-checkbox"),P=I("n-input"),i=I("n-form"),h=I("n-modal");return c(),_("div",Se,[t("div",Ne,[t("div",$e,[p(w,{justify:"center",style:{"margin-top":"10px"}},{default:r(()=>[p(q,null,{default:r(()=>[p(u,{secondary:"",strong:"",round:"",color:"#6B9AC4",onClick:me},{default:r(()=>[j("返回首页")]),_:1}),v.value?(c(),O(u,{key:0,secondary:"",strong:"",round:"",color:"#F4B942",onClick:ne},{default:r(()=>[j("退出登录")]),_:1})):T("",!0),v.value?(c(),O(u,{key:1,secondary:"",strong:"",round:"",color:"#97D8C4",onClick:ce},{default:r(()=>[j("跳转到当前周")]),_:1})):T("",!0)]),_:1})]),_:1}),v.value?(c(),_("div",De,[ye(t("select",{class:"select","onUpdate:modelValue":o[0]||(o[0]=s=>W.value=s)},[(c(),_(U,null,X(K,(s,l)=>t("option",Ie({class:"date_option",value:s.value},l),m(s.label),17,We)),64))],512),[[be,W.value]]),v.value?(c(),_("span",Be,[j("当前周次: "),t("span",ze,m(g.value),1)])):T("",!0)])):T("",!0),v.value?(c(),_("table",qe,[t("div",Pe,[t("thead",null,[t("tr",null,[(c(!0),_(U,null,X(Q.value,(s,l)=>(c(),_("th",{class:te(["courseTopInfo",{today:ae.value===s.xqid*1}]),key:l},[t("span",Me,"星期"+m(s.xqmc),1),t("span",Ue,m(s.mxrq),1)],2))),128))])]),t("tbody",Ve,[(c(!0),_(U,null,X(b.value,(s,l)=>(c(),_("tr",{key:l},[(c(!0),_(U,null,X(s,(x,Y)=>(c(),_("td",{key:Y,onClick:M=>ue(x),class:te([x.courseName==E.value?"noCourse":"haveCourse","courseCell"])},[t("span",Le,m(x.courseName),1),t("span",Ae,m(x.classroomName),1)],10,Fe))),128))]))),128))])])])):T("",!0)]),v.value?T("",!0):(c(),O(i,{key:0,class:"bottom"},{default:r(()=>[p(G,{checked:A.value,"onUpdate:checked":o[1]||(o[1]=s=>A.value=s),disabled:a.account!=""||a.password!=""},{default:r(()=>[j(m(a.account!=""||a.password!=""?"使用默认账号（前端2202 cyx）请清空输入框再选择":"使用默认账号（前端2202 cyx）"),1)]),_:1},8,["checked","disabled"]),p(w,{vertical:""},{default:r(()=>[A.value?T("",!0):(c(),_(U,{key:0},[p(P,{placeholder:"输入账号",maxlength:9,request:"",value:a.account,"onUpdate:value":o[2]||(o[2]=s=>a.account=s),clearable:""},null,8,["value"]),p(P,{type:"password",request:"",placeholder:"输入密码","show-password-on":"click",value:a.password,"onUpdate:value":o[3]||(o[3]=s=>a.password=s),clearable:""},null,8,["value"])],64)),p(w,{justify:"center"},{default:r(()=>[p(u,{onClick:re},{default:r(()=>[j("登录")]),_:1})]),_:1})]),_:1})]),_:1}))]),p(h,{show:L.value,"onUpdate:show":o[5]||(o[5]=s=>L.value=s),class:"classDetail",preset:"card",style:xe(le.value),title:"上啥课啊？",size:"small",bordered:!1,segmented:e.segmented},{"header-extra":r(()=>[Ge]),footer:r(()=>[st]),default:r(()=>[t("div",He,[t("ul",Xe,[t("li",null,[Ee,t("span",Ke,m(k.courseNameTitle),1)]),t("li",null,[Re,t("span",Ye,m(k.courseTime),1)]),t("li",null,[Je,t("span",Oe,m(k.coursePosition),1)]),t("li",null,[Qe,t("span",Ze,m(k.courseTeacher),1)]),t("li",null,[et,t("span",tt,m(k.courseNeedWeek),1)])]),p(w,{justify:"center"},{default:r(()=>[p(u,{tertiary:"",type:"primary",onClick:o[4]||(o[4]=s=>L.value=!1),style:{width:"60vw"}},{default:r(()=>[j("确定")]),_:1})]),_:1})])]),_:1},8,["show","style","segmented"])])}}},ct=ke(ot,[["__scopeId","data-v-50e6a362"]]);export{ct as default};
