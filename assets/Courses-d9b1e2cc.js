import{_ as me,u as ve,b as he,i as U,e as l,k as A,l as ke,E as ge,f as fe,r as C,o as m,g as f,j as t,h as i,w as u,F as V,x as G,m as K,c as Z,p as we,a as N,t as g,n as ee,z as be,A as ye}from"./index-b1a5b2e3.js";const b=z=>(be("data-v-5211fbce"),z=z(),ye(),z),xe={class:"classTableWrap"},Ie={class:"right"},je={class:"current_Week"},Te={class:"current_Week_num"},Ce={key:0,bordered:!1,"single-line":!1},Ne={class:"classTable"},Se={style:{"font-size":"12px",height:"5px",display:"inline-block"}},De={style:{"font-size":"12px",height:"5px",display:"inline-block"}},$e={style:{width:"100%"}},We=["onClick"],ze=b(()=>t("div",{class:"classDetailHeader"},[t("p",null,"哦吼！原来今天还要上课嘞？"),t("p",null,"？？？")],-1)),Be={class:"classDetailContent"},qe={class:"content"},Me=b(()=>t("span",{class:"content_left"},"课程名称:",-1)),Pe={class:"content_right"},Le=b(()=>t("span",{class:"content_left"},"时间:",-1)),Ue={class:"content_right"},Ve=b(()=>t("span",{class:"content_left"},"地点:",-1)),Fe={class:"content_right"},Ee=b(()=>t("span",{class:"content_left"},"教师:",-1)),He={class:"content_right"},Re=b(()=>t("span",{class:"content_left"},"教学周:",-1)),Ae={class:"content_right"},Ge=b(()=>t("div",{class:"classDetailFooter"},[t("p",null,"快去学习！"),t("p",null,"要不给你打个鸡血？"),t("p",null,"额。。。"),t("p",null,"还是算了~")],-1)),Ke={__name:"Courses",setup(z){ve();const te=he(),B=U("axios"),y=U("message"),se=U("dialog"),x=U("loadingBar"),I=l(1),j=l([]),v=l([]),q=l(!1),d=A({courseNameTitle:"",courseTime:"",coursePosition:"",courseTeacher:"",courseNeedWeek:""}),ae=ke(()=>new Date().getDay());l("today");const oe=l({width:"80%",height:"80vh"}),F=l("没课！玩去咯~"),w=l(!1),J=[],r=A({account:"",password:""}),S=l(null);ge(S,e=>{I.value=S.value,O()});const le=e=>{console.log(e)},_=A({maxWeek:"21",semesterId:"2023-2024-1",today:"2023-09-27",week:"5",weekday:"星期三"}),E=l([]),ne=()=>{se.create({type:"warning",title:"退出登录?",content:"退出了可就要重新登录了哈，而且慧通九职哪里也要重新登录",negativeText:"点错了",positiveText:"退出",onNegativeClick:()=>{},onPositiveClick:()=>{localStorage.removeItem("school_course_user_token"),localStorage.removeItem("school_user_token"),localStorage.removeItem("kbjcmsid"),w.value=!1}})},ce=()=>{console.log(_.week),I.value=parseInt(_.week),S.value=null,M()};fe(()=>{D.value=localStorage.getItem("school_course_user_token"),H.value=localStorage.getItem("school_course_user_token"),T.value=localStorage.getItem("school_user_token"),$.value=localStorage.getItem("kbjcmsid"),I.value=_.week,console.log($.value,I.value),D.value!=""&&T.value!=""?(w.value=!0,M()):w.value=!1;for(let e=1;e<=_.maxWeek;++e)J.push({label:`星期${e}`,value:e});console.log(E.value)});const ue=()=>{if(r.account==""){y.warning("就不能输个账号？",{duration:1e3});return}if(r.password==""){y.warning("就不能输个密码？",{duration:1e3});return}console.log(r.account),console.log(r.password),de(),r.account="",r.password=""},re=e=>{e.courseName!=F.value&&(console.log(e),q.value=!0,d.courseNameTitle=`${e.courseName} (${e.fzmc==""?"不是体育课，废话！-_- ":e.fzmc}) `,d.courseTime=` ${ie(e.classTime)} (${e.startTime}-${e.endTIme})`,d.coursePosition=e.classroomName,d.courseTeacher=e.teacherName,d.courseNeedWeek=`第${e.classWeek}周`)},ie=e=>{let s=e.substring(0,1),p=e.substring(1,e.length);switch(s){case"1":s="星期一";break;case"2":s="星期二";break;case"3":s="星期三";break;case"4":s="星期四";break;case"5":s="星期五";break;case"6":s="星期六";break;case"7":s="星期日";break}return p=`第${p}节`,`${s}，${p}`},D=l(""),H=l(""),T=l(""),$=l(""),de=async()=>{x.start();try{let e=await B({url:"/course/get_login",method:"post",params:{username:r.account,password:r.password}});D.value=e.data.data.idToken,H.value=e.data.data.idToken,console.log(e),localStorage.setItem("school_course_user_token",D.value),w.value=!0,y.success("登录成功",{duration:1e3}),M(),x.finish()}catch{y.error("登录失败"),x.error()}},M=async()=>{x.start(),await B({url:"/course/get_token",method:"get",params:{url:"http://m-jiaowu.jvtc.jx.cn/njwhd/loginSso?toMenu=xs_kcb"},headers:{usertoken:D.value,x_id_token:H.value}}).then(e=>{const s=e.data,p=/token=([^&]+)/;let k=s.match(p)[1];T.value=k,localStorage.setItem("school_user_token",T.value),_e()})},_e=async()=>{let s=(await B({url:"/course/get_sjkbms",method:"post",params:{url:"http://mm-jiaowu.jvtc.jx.cn/njwhd/Get_sjkbms",token:T.value}})).data.data[0].kbjcmsid;$.value=s,localStorage.setItem("kbjcmsid",$.value),O()},O=async()=>{x.start(),v.value=[],j.value=[];let e=await B({url:"/course/get_kcb",method:"post",params:{url:`http://mm-jiaowu.jvtc.jx.cn/njwhd/student/curriculum?week=${I.value}&kbjcmsid=${$.value}`,token:T.value}});if(e.data.code!="1"&&M(),console.log(e),E.value=e.data.data[0].date,_.maxWeek=e.data.data[0].topInfo[0].maxWeek,_.semesterId=e.data.data[0].topInfo[0].semesterId,_.today=e.data.data[0].topInfo[0].today,_.week=e.data.data[0].topInfo[0].week,_.weekday=e.data.data[0].topInfo[0].weekday,console.log(_),e.data.code==1){let s=[],p=[],h=[],k=[],W=[],P=[];for(let n=0;n<e.data.data[0].item.length;n++){const a=e.data.data[0].item[n];for(let c=0;c<a.length;c++){const o=a[c][0];switch(parseInt(o.classTime.substring(2,3))){case 1:s.push(o);break;case 3:p.push(o);break;case 5:h.push(o);break;case 7:k.push(o);break;case 9:W.push(o);break;case 11:P.push(o);break}}}v.value.push(s),v.value.push(p),v.value.push(h),v.value.push(k),v.value.push(W),v.value.push(P),y.success(`加载课程表成功！${e.data.Msg}`,{duration:1e3});for(let n=0;n<6;n++){const a=[];for(let c=0;c<7;c++)a.push({courseName:F.value,classTime:2*n+1,weekDay:c+1});j.value.push(a)}for(let n=0;n<v.value.length;n++){const a=v.value[n];for(let c=0;c<a.length;c++){const o=a[c],R=parseInt(o.classTime.substring(2,3)),Q=parseInt(o.weekDay);for(let L=0;L<j.value.length;L++){const X=j.value[L].findIndex(Y=>Y.weekDay===Q&&Y.classTime===R);if(X!==-1){j.value[L][X]=o;break}}}}x.finish()}else y.error(`加载课程表时出现错误！${e.data.Msg}`),console.log(e.data.Msg)},pe=()=>{te.push("/")};return(e,s)=>{const p=C("n-select"),h=C("n-button"),k=C("n-space"),W=C("n-input"),P=C("n-form"),n=C("n-modal");return m(),f(V,null,[t("div",xe,[t("div",Ie,[i(p,{value:S.value,"onUpdate:value":s[0]||(s[0]=a=>S.value=a),size:"large",options:J,update:le,placeholder:"选择周次，默认为当前周"},null,8,["value"]),i(k,null,{default:u(()=>[i(h,{onClick:pe},{default:u(()=>[N("返回首页")]),_:1}),w.value?(m(),Z(h,{key:0,onClick:ne},{default:u(()=>[N("退出登录")]),_:1})):K("",!0),i(h,{onClick:ce},{default:u(()=>[N("跳转当前周次")]),_:1}),t("span",je,[N("当前周次: "),t("span",Te,g(I.value),1)])]),_:1}),w.value?(m(),f("table",Ce,[t("div",Ne,[t("thead",null,[t("tr",null,[(m(!0),f(V,null,G(E.value,(a,c)=>(m(),f("th",{class:ee(["courseTopInfo",{today:ae.value===a.xqid*1}])},[t("span",Se,"星期"+g(a.xqmc),1),t("span",De,g(a.mxrq),1)],2))),256))])]),t("tbody",$e,[(m(!0),f(V,null,G(j.value,(a,c)=>(m(),f("tr",null,[(m(!0),f(V,null,G(a,(o,R)=>(m(),f("td",{onClick:Q=>re(o),class:ee([o.courseName==F.value?"noCourse":"haveCourse","courseCell"])},[t("span",null,g(o.courseName),1)],10,We))),256))]))),256))])])])):K("",!0)]),w.value?K("",!0):(m(),Z(P,{key:0,class:"bottom"},{default:u(()=>[i(k,{vertical:""},{default:u(()=>[i(W,{placeholder:"输入账号",maxlength:9,request:"",value:r.account,"onUpdate:value":s[1]||(s[1]=a=>r.account=a),clearable:""},null,8,["value"]),i(W,{type:"password",request:"",placeholder:"输入密码","show-password-on":"mousedown",value:r.password,"onUpdate:value":s[2]||(s[2]=a=>r.password=a),clearable:""},null,8,["value"]),i(k,{justify:"center"},{default:u(()=>[i(h,{onClick:ue},{default:u(()=>[N("登录")]),_:1})]),_:1})]),_:1})]),_:1}))]),i(n,{show:q.value,"onUpdate:show":s[4]||(s[4]=a=>q.value=a),class:"classDetail",preset:"card",style:we(oe.value),title:"上啥课啊？",size:"small",bordered:!1,segmented:e.segmented},{"header-extra":u(()=>[ze]),footer:u(()=>[Ge]),default:u(()=>[t("div",Be,[t("ul",qe,[t("li",null,[Me,t("span",Pe,g(d.courseNameTitle),1)]),t("li",null,[Le,t("span",Ue,g(d.courseTime),1)]),t("li",null,[Ve,t("span",Fe,g(d.coursePosition),1)]),t("li",null,[Ee,t("span",He,g(d.courseTeacher),1)]),t("li",null,[Re,t("span",Ae,g(d.courseNeedWeek),1)])]),i(k,{justify:"center"},{default:u(()=>[i(h,{tertiary:"",type:"primary",onClick:s[3]||(s[3]=a=>q.value=!1),style:{width:"60vw"}},{default:u(()=>[N("确定")]),_:1})]),_:1})])]),_:1},8,["show","style","segmented"])],64)}}},Qe=me(Ke,[["__scopeId","data-v-5211fbce"]]);export{Qe as default};
